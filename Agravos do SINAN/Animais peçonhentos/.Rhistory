knitr::opts_chunk$set(echo = TRUE)
setwd("~/GitHub/dimensionamento/Agravos do SINAN/Animais peçonhentos")
library(tidyverse)
library(lubridate)
library(RODBC)
dremio_host <- "200.137.215.27"
dremio_port <- "31010"
dremio_uid <- "daniel"
dremio_pwd <- Sys.getenv("datalake")
channel <- odbcDriverConnect(sprintf("DRIVER=Dremio Connector;HOST=%s;PORT=%s;UID=%s;PWD=%s;AUTHENTICATIONTYPE=Basic Authentication;CONNECTIONTYPE=Direct", dremio_host, dremio_port, dremio_uid, dremio_pwd))
df_territorial <- sqlQuery(channel,
'SELECT * FROM "Analytics Layer".Territorial."Municípios - Hierarquia Completa"')
write.csv(df_territorial, "df_territorial.csv")
df_territorial <- read_delim("https://raw.githubusercontent.com/danielppagotto/dimensionamento/main/Agravos%20do%20SINAN/Animais%20pe%C3%A7onhentos/df_territorial.csv")
df_territorial <- read.csv("https://raw.githubusercontent.com/danielppagotto/dimensionamento/main/Agravos%20do%20SINAN/Animais%20pe%C3%A7onhentos/df_territorial.csv")
View(df_territorial)
knitr::opts_chunk$set(echo = TRUE)
setwd("~/GitHub/dimensionamento/Agravos do SINAN/Animais peçonhentos")
library(tidyverse)
library(lubridate)
animais <- read.dbc::read.dbc("ANIMBR21.dbc")
write.csv(animais, "animais.csv")
arrow::write_parquet(animais, "animais.parquet")
animais <- arrow::read_parquet("animais.parquet")
animais_t <- arrow::read_parquet("animais.parquet")
View(animais_t)
animais_t <- arrow::read_parquet("https://github.com/danielppagotto/dimensionamento/blob/main/Agravos%20do%20SINAN/Animais%20pe%C3%A7onhentos/animais.parquet?raw=true")
animais_t <- arrow::read_parquet("https://github.com/danielppagotto/dimensionamento/raw/main/Agravos%20do%20SINAN/Animais%20pe%C3%A7onhentos/animais.parquet")
animais_t <- arrow::read_parquet("https://github.com/danielppagotto/dimensionamento/raw/main/Agravos%20do%20SINAN/Animais%20pe%C3%A7onhentos/animais.parquet")
animais_t <- arrow::read_parquet("https://github.com/danielppagotto/dimensionamento/raw/main/Agravos%20do%20SINAN/Animais%20pe%C3%A7onhentos/animais.parquet")
df_territorial <- read.csv("https://raw.githubusercontent.com/danielppagotto/dimensionamento/main/Agravos%20do%20SINAN/Animais%20pe%C3%A7onhentos/df_territorial.csv")
animais_t <- read.csv("https://github.com/danielppagotto/dimensionamento/blob/main/Agravos%20do%20SINAN/Animais%20pe%C3%A7onhentos/animais.csv?raw=true")
teste <- read.dbc::read.dbc("https://github.com/danielppagotto/dimensionamento/blob/main/Agravos%20do%20SINAN/Animais%20pe%C3%A7onhentos/ANIMBR21.dbc?raw=true")
x <- 1.77809
round(x, 2)
base_animais <- animais %>%
mutate(faixa_etaria = case_when(NU_IDADE_N < 4000 ~ "Menor que 1 ano",
NU_IDADE_N >= 4000 & NU_IDADE_N < 4005 ~ "Entre 1 e 4 anos",
NU_IDADE_N >= 4005 & NU_IDADE_N < 4015 ~ "Entre 5 e 14 anos",
NU_IDADE_N >= 4015 & NU_IDADE_N < 4025 ~ "Entre 15 e 24 anos",
NU_IDADE_N >= 4025 & NU_IDADE_N < 4035 ~ "Entre 25 e 34 anos",
NU_IDADE_N >= 4035 & NU_IDADE_N < 4045 ~ "Entre 35 e 44 anos",
NU_IDADE_N >= 4045 & NU_IDADE_N < 4055 ~ "Entre 45 e 54 anos",
NU_IDADE_N >= 4055 & NU_IDADE_N < 4065 ~ "Entre 55 e 64 anos",
NU_IDADE_N >= 4065 ~ "65 ou mais ")) %>%
mutate(tipo_animais = case_when(TP_ACIDENT == 1 ~ "Serpente",
TP_ACIDENT == 2 ~ "Aranha",
TP_ACIDENT == 3 ~ "Escorpião",
TP_ACIDENT == 4 ~ "Lagarta",
TP_ACIDENT == 5 ~ "Abelha",
TP_ACIDENT == 6 ~ "Outros",
TP_ACIDENT == 9 ~ " Ignorado" ))%>%
mutate(gravidade = case_when(TRA_CLASSI == 1 ~ "Leve",
TRA_CLASSI == 2 ~ "Moderado",
TRA_CLASSI == 3 ~ "Grave",
TRA_CLASSI == 9 ~ "Ignorado")) %>%
mutate(mes_ano = ymd(DT_NOTIFIC),
mes_ano = format_ISO8601(mes_ano, precision = "ym"),
mes_ano = ym(mes_ano)) %>%
left_join(df_territorial, by = c("ID_MN_RESI" = "cod_municipio"))
df_territorial$cod_municipio <- as.character(df_territorial$cod_municipio)
base_animais <- animais %>%
mutate(faixa_etaria = case_when(NU_IDADE_N < 4000 ~ "Menor que 1 ano",
NU_IDADE_N >= 4000 & NU_IDADE_N < 4005 ~ "Entre 1 e 4 anos",
NU_IDADE_N >= 4005 & NU_IDADE_N < 4015 ~ "Entre 5 e 14 anos",
NU_IDADE_N >= 4015 & NU_IDADE_N < 4025 ~ "Entre 15 e 24 anos",
NU_IDADE_N >= 4025 & NU_IDADE_N < 4035 ~ "Entre 25 e 34 anos",
NU_IDADE_N >= 4035 & NU_IDADE_N < 4045 ~ "Entre 35 e 44 anos",
NU_IDADE_N >= 4045 & NU_IDADE_N < 4055 ~ "Entre 45 e 54 anos",
NU_IDADE_N >= 4055 & NU_IDADE_N < 4065 ~ "Entre 55 e 64 anos",
NU_IDADE_N >= 4065 ~ "65 ou mais ")) %>%
mutate(tipo_animais = case_when(TP_ACIDENT == 1 ~ "Serpente",
TP_ACIDENT == 2 ~ "Aranha",
TP_ACIDENT == 3 ~ "Escorpião",
TP_ACIDENT == 4 ~ "Lagarta",
TP_ACIDENT == 5 ~ "Abelha",
TP_ACIDENT == 6 ~ "Outros",
TP_ACIDENT == 9 ~ " Ignorado" ))%>%
mutate(gravidade = case_when(TRA_CLASSI == 1 ~ "Leve",
TRA_CLASSI == 2 ~ "Moderado",
TRA_CLASSI == 3 ~ "Grave",
TRA_CLASSI == 9 ~ "Ignorado")) %>%
mutate(mes_ano = ymd(DT_NOTIFIC),
mes_ano = format_ISO8601(mes_ano, precision = "ym"),
mes_ano = ym(mes_ano)) %>%
left_join(df_territorial, by = c("ID_MN_RESI" = "cod_municipio"))
tipo_animal <- c("Serpente", "Aranha", "Escorpião", "Lagarta", "Abelha")
funcao_propria <- function(tipo_animal){
base_animais %>%
filter(tipo_animais == tipo_animal) %>%
group_by(tipo_animais, uf, mes_ano) %>%
summarise(total = n())
}
bases <- tibble()
for (animal in tipo_animal){
intermed <- funcao_propria(tipo_animal = animal)
bases <- rbind(intermed, bases)
}
View(bases)
View(base_animais)
tipo_animal <- c("Serpente", "Aranha", "Escorpião", "Lagarta", "Abelha")
funcao_propria <- function(tipo_animal){
base_animais %>%
filter(tipo_animais == tipo_animal) %>%
group_by(tipo_animais, municipio, uf, latitude, longitude, mes_ano) %>%
summarise(total = n())
}
bases <- tibble()
for (animal in tipo_animal){
intermed <- funcao_propria(tipo_animal = animal)
bases <- rbind(intermed, bases)
}
tipo_animal <- c("Serpente", "Aranha", "Escorpião", "Lagarta", "Abelha")
funcao_propria <- function(tipo_animal){
base_animais %>%
filter(tipo_animais == tipo_animal) %>%
group_by(tipo_animais, cod_municipio, municipio, uf, latitude, longitude, mes_ano) %>%
summarise(total = n())
}
bases <- tibble()
for (animal in tipo_animal){
intermed <- funcao_propria(tipo_animal = animal)
bases <- rbind(intermed, bases)
}
base_animais %>%
filter(tipo_animais == tipo_animal) %>%
group_by(tipo_animais, cod_municipio, ID_MN_RESI, uf, latitude, longitude, mes_ano) %>%
summarise(total = n())
tipo_animal <- c("Serpente", "Aranha", "Escorpião", "Lagarta", "Abelha")
funcao_propria <- function(tipo_animal){
base_animais %>%
filter(tipo_animais == tipo_animal) %>%
group_by(tipo_animais, cod_municipio, ID_MN_RESI, uf, latitude, longitude, mes_ano) %>%
summarise(total = n())
}
bases <- tibble()
for (animal in tipo_animal){
intermed <- funcao_propria(tipo_animal = animal)
bases <- rbind(intermed, bases)
}
tipo_animal <- c("Serpente", "Aranha", "Escorpião", "Lagarta", "Abelha")
funcao_propria <- function(tipo_animal){
base_animais %>%
filter(tipo_animais == tipo_animal) %>%
group_by(tipo_animais, ID_MN_RESI, municipio, uf, latitude, longitude, mes_ano) %>%
summarise(total = n())
}
bases <- tibble()
for (animal in tipo_animal){
intermed <- funcao_propria(tipo_animal = animal)
bases <- rbind(intermed, bases)
}
View(bases)
write.csv(bases, "casos_animais.csv")
